<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SSR的1080端口被占用</title>
    <url>/1080-port-of-SSR-is-occupied/</url>
    <content><![CDATA[<h2 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h2><p>刚才Windows更新完，再次打开SSR报错：<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/image-bed/images/20200316174735.png" alt=""><br>如果怕麻烦，直接重启电脑。但下次可能还会出现问题。</p>
<a id="more"></a>

<h2 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h2><p>本文给出两种方案，仅供参考。</p>
<ul>
<li>方案一：就像其他博主给出的方案，在CMD里使用 <code>netstat -aon|findstr &quot;1080&quot;</code>，找到占用端口进程的PID，在任务管理器里结束进程。</li>
<li>方案二：很多时候，你会发现，并没有进程在占用1080端口：</li>
</ul>
<p>这个问题并不是端口被占用，通过 <code>netstat</code> 里找不到占用这个端口的程序。实际上，这个错误对应的 last-error 是 10013 （WSAEACCESS），权限不足。</p>
<p>根据2018年2月13日发布的 KB4074588 里的 known issue，这个补丁会调整操作系统的 reserve port ranges，可以通过运行 以下指令查看。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netsh interface ipv4 show excludedportrange protocol=tcp</span><br></pre></td></tr></table></figure>

<p>在我自己的环境里，1064 ~ 1163 都被系统强制保留了，所以其他应用程序无法监听在这个端口，比如1080。</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/image-bed/images/20200316175718.png" alt=""></p>
<p>除了系统补丁会保留端口外，开启win10的 <code>hyper-v</code> 也会保留端口</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>以下两个方法选一个就可以了。<br>随便改成一个没被保留的端口。</p>
<ol>
<li>通过SSR客户端<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/image-bed/images/20200316175940.png" alt=""></li>
<li>修改 <code>gui-config.json</code></li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://juejin.im/post/5de4fafee51d4530e9129b27" target="_blank" rel="noopener">https://juejin.im/post/5de4fafee51d4530e9129b27</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks-windows/issues/1835" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks-windows/issues/1835</a></li>
</ol>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>科学上网</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript之函数记忆</title>
    <url>/function-memory/</url>
    <content><![CDATA[<p>函数记忆？？我的理解就是记忆化搜索、以空间换时间，我用C++其实写的挺多的。</p>
<p>以经典的fibonaci为例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    count++</span><br><span class="line">    <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n : f(n - <span class="number">1</span>) + f(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i,f(i))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'执行次数'</span>, count)</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>执行结果:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0 0</span><br><span class="line">1 1</span><br><span class="line">2 1</span><br><span class="line">3 2</span><br><span class="line">4 3</span><br><span class="line">5 5</span><br><span class="line">6 8</span><br><span class="line">7 13</span><br><span class="line">8 21</span><br><span class="line">9 34</span><br><span class="line">10 55</span><br><span class="line"><span class="string">'执行次数'</span>, 453</span><br></pre></td></tr></table></figure>

<p>接下来，我们定义一个memo的数组来保存我们得储存结果，并把它隐藏在闭包中，让该函数能一直访问到这个数组，不被垃圾回收机制回收</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> memo = [<span class="number">0</span>,<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> fib = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">        count++</span><br><span class="line">        <span class="keyword">var</span> result = memo[n];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> result !== <span class="string">'number'</span>)&#123;</span><br><span class="line">            result = fib(n - <span class="number">1</span>) + fib(n - <span class="number">2</span>)</span><br><span class="line">            memo[n] = result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fib</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i,f(i))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'执行次数'</span>, count)</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0 0</span><br><span class="line">1 1</span><br><span class="line">2 1</span><br><span class="line">3 2</span><br><span class="line">4 3</span><br><span class="line">5 5</span><br><span class="line">6 8</span><br><span class="line">7 13</span><br><span class="line">8 21</span><br><span class="line">9 34</span><br><span class="line">10 55</span><br><span class="line">执行次数 29</span><br></pre></td></tr></table></figure>

<p>可见调用次数远远减少，分析一下，应该是从 $2^n \rightarrow n^2$.</p>
<p>我没用闭包写了一下，结果一样，不知道有什么区别：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> memo = [<span class="number">0</span>,<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">var</span> ret = memo[n];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> ret === <span class="string">'number'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> memo[n] = f(n<span class="number">-1</span>) + f(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i,f(i))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'执行次数'</span>, count)</span><br></pre></td></tr></table></figure>

<p>参考链接：<a href="http://www.wclimb.site/2018/07/12/JavaScript%E4%B9%8B%E5%87%BD%E6%95%B0%E8%AE%B0%E5%BF%86/" target="_blank" rel="noopener">wclimb-JavaScript之函数记忆</a></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>throttle</title>
    <url>/throttle/</url>
    <content><![CDATA[<p>我们在开发的过程中会经常使用如scroll、resize、touchmove等事件，如果正常绑定事件处理函数的话，有可能在很短的时间内多次连续触发事件，十分影响性能。<br>因此针对这类事件要进行节流或者防抖处理。</p>
<a id="more"></a>

<h2 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h2><p>节流的意思是，在规定的时间内只会触发一次函数，如我们设置函数500ms触发一次。期间无论你触发了多少次函数，在这个时间内只会执行一次。</p>
<p>先来看个例子：</p>
<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="wclimb" data-slug-hash="gKWLpO" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="gKWLpO">
  <span>See the Pen <a href="https://codepen.io/wclimb/pen/gKWLpO" target="_blank" rel="noopener">
  gKWLpO</a> by wclimb (<a href="https://codepen.io/wclimb" target="_blank" rel="noopener">@wclimb</a>)
  on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

<p>我们看到使用了节流的在1000ms内只触发了一次，而没有使用节流的则频繁触发了调用的函数。</p>
<p>接下来看看代码实现<br>v1 第一次不触发，不传参实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn,interval</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">            fn()</span><br><span class="line">        &#125;, interval || <span class="number">1000</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果是实现了，但是我尝试在执行函数里console.log(this)，结果发现this指向的是window，而且还发现我们不能传递参数，下面就来改进一下</p>
<p>v2 第一次触发函数，接收参数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn,interval</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timer,</span><br><span class="line">        isFirst = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>,</span><br><span class="line">            that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span>(isFirst)&#123;</span><br><span class="line">            fn.apply(that,args)</span><br><span class="line">            <span class="keyword">return</span> isFirst = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">            fn.apply(that,args)</span><br><span class="line">        &#125;, interval || <span class="number">1000</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><p>防抖的意思是无论你触发多少次函数，只会触发最后一次函数。最常用的就是在表单提交的时候，用户可能会一段时间内点击很多次，这个时候可以增加防抖处理，我们只需要最后一次触发的事件</p>
<p>先来看一个例子：</p>
<p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="wclimb" data-slug-hash="pKPeyv" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="pKPeyv">
  <span>See the Pen <a href="https://codepen.io/wclimb/pen/pKPeyv" target="_blank" rel="noopener">
  pKPeyv</a> by wclimb (<a href="https://codepen.io/wclimb" target="_blank" rel="noopener">@wclimb</a>)
  on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

<p>我们看到使用了防抖的方框，无论你在里面触发了多少次函数，都只会触发最后的那一次函数，而没有使用防抖的则频繁触发了调用的函数</p>
<p>v1 第一次不触发函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn,interval</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>,</span><br><span class="line">            that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            fn.apply(<span class="literal">null</span>,args)</span><br><span class="line">        &#125;, interval || <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码仍然可以正常执行，但是我们并没有指定他的this</p>
<p>v2 第一次就触发函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fn,interval</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timer,</span><br><span class="line">        isFirst  = <span class="literal">true</span>,</span><br><span class="line">            can = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>,</span><br><span class="line">            that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isFirst)&#123;</span><br><span class="line">            fn.apply(that,args)</span><br><span class="line">            isFirst = <span class="literal">false</span></span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                can = <span class="literal">true</span></span><br><span class="line">            &#125;, interval || <span class="number">1000</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(can)&#123;</span><br><span class="line">            timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                fn.apply(<span class="literal">null</span>,args)</span><br><span class="line">            &#125;, interval || <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.wclimb.site/2018/06/12/JavaScript%E4%B9%8B%E8%8A%82%E6%B5%81%E4%B8%8E%E9%98%B2%E6%8A%96/" target="_blank" rel="noopener">wclimb-avaScript之节流与防抖</a></li>
</ol>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Node+Koa2+Mysql 搭建简易博客</title>
    <url>/Node-Koa2-Mysql-Blog/</url>
    <content><![CDATA[<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><ul>
<li>config 存放默认文件</li>
<li>lib 存放操作数据库文件</li>
<li>controller 逻辑控制文件</li>
<li>middlewares 存放判断登录与否文件</li>
<li>public 存放样式和头像文件</li>
<li>routes 存放路由文件</li>
<li>views 存放模板文件</li>
<li>index 程序主文件</li>
<li>package.json 包括项目名、作者、依赖等等</li>
</ul>
<a id="more"></a>
<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/image-bed/images/20200225123416.png" alt="目录结构"></p>
<h2 id="首先配置config"><a href="#首先配置config" class="headerlink" title="首先配置config"></a>首先配置config</h2><p>我们新建default.js文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="comment">// 启动端口</span></span><br><span class="line">  port: <span class="number">3000</span>,</span><br><span class="line">  <span class="comment">// 数据库配置</span></span><br><span class="line">  database: &#123;</span><br><span class="line">    DATABASE: <span class="string">'nodesql'</span>,</span><br><span class="line">    USERNAME: <span class="string">'root'</span>,</span><br><span class="line">    PASSWORD: <span class="string">'123456'</span>,</span><br><span class="line">    PORT: <span class="string">'3306'</span>,</span><br><span class="line">    HOST: <span class="string">'localhost'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>

<p>这是我们所需的一些字段，包括端口和数据库连接所需，最后我们把它exports暴露出去，以便可以在别的地方使用</p>
<h2 id="配置index-js文件"><a href="#配置index-js文件" class="headerlink" title="配置index.js文件"></a>配置index.js文件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa=<span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> path=<span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>);</span><br><span class="line"><span class="keyword">const</span> ejs=<span class="built_in">require</span>(<span class="string">'ejs'</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session-minimal'</span>);</span><br><span class="line"><span class="keyword">const</span> MysqlStore = <span class="built_in">require</span>(<span class="string">'koa-mysql-session'</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./config/default.js'</span>);</span><br><span class="line"><span class="keyword">const</span> router=<span class="built_in">require</span>(<span class="string">'koa-router'</span>)</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">'koa-views'</span>)</span><br><span class="line"><span class="comment">// const koaStatic = require('koa-static')</span></span><br><span class="line"><span class="keyword">const</span> staticCache = <span class="built_in">require</span>(<span class="string">'koa-static-cache'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// session存储配置</span></span><br><span class="line"><span class="keyword">const</span> sessionMysqlConfig= &#123;</span><br><span class="line">  user: config.database.USERNAME,</span><br><span class="line">  password: config.database.PASSWORD,</span><br><span class="line">  database: config.database.DATABASE,</span><br><span class="line">  host: config.database.HOST,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置session中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  key: <span class="string">'USER_SID'</span>,</span><br><span class="line">  store: <span class="keyword">new</span> MysqlStore(sessionMysqlConfig)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置静态资源加载中间件</span></span><br><span class="line"><span class="comment">// app.use(koaStatic(</span></span><br><span class="line"><span class="comment">//   path.join(__dirname , './public')</span></span><br><span class="line"><span class="comment">// ))</span></span><br><span class="line"><span class="comment">// 缓存</span></span><br><span class="line">app.use(staticCache(path.join(__dirname, <span class="string">'./public'</span>), &#123; <span class="attr">dynamic</span>: <span class="literal">true</span> &#125;, &#123;</span><br><span class="line">  maxAge: <span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span><br><span class="line">&#125;))</span><br><span class="line">app.use(staticCache(path.join(__dirname, <span class="string">'./images'</span>), &#123; <span class="attr">dynamic</span>: <span class="literal">true</span> &#125;, &#123;</span><br><span class="line">  maxAge: <span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置服务端模板渲染引擎中间件</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">'./views'</span>), &#123;</span><br><span class="line">  extension: <span class="string">'ejs'</span></span><br><span class="line">&#125;))</span><br><span class="line">app.use(bodyParser(&#123;</span><br><span class="line">  formLimit: <span class="string">'1mb'</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">//  路由(我们先注释三个，等后面添加好了再取消注释，因为我们还没有定义路由，稍后会先实现注册)</span></span><br><span class="line"><span class="comment">//app.use(require('./routers/signin.js').routes())</span></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'./routers/signup.js'</span>).routes())</span><br><span class="line"><span class="comment">//app.use(require('./routers/posts.js').routes())</span></span><br><span class="line"><span class="comment">//app.use(require('./routers/signout.js').routes())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`listening on port <span class="subst">$&#123;config.port&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<p>我们使用<code>koa-mysql-session</code>来进行数据库的操作， 使用<code>koa-static</code>配置静态资源，目录设置为<code>public</code>，使用<code>ejs</code>模板引擎，使用<code>koa-bodyparser</code>来解析提交的表单信息，使用<code>koa-router</code>做路由，使用<code>koa-static-cache</code>来缓存文件.</p>
<p>之前我们配置了default.js，我们就可以在这里使用了。</p>
<h2 id="配置lib的mysql-js文件"><a href="#配置lib的mysql-js文件" class="headerlink" title="配置lib的mysql.js文件"></a>配置lib的mysql.js文件</h2><p>首先我们建立了数据库的连接池，以便后面的操作都可以使用到。</p>
<p>我们创建了一个函数query，通过返回promise的方式以便可以方便用.then()来获取数据库返回的数据。</p>
<p>然后我们定义了三个表的字段，通过createTable来创建我们后面所需的三个表，包括posts(存储文章)，users(存储用户)，comment(存储评论)，create table if not exists users()表示如果users表不存在则创建该表，避免每次重复建表报错的情况。</p>
<p>后面我们定义了一系列的方法，最后把他们exports暴露出去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../config/default.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pool  = mysql.createPool(&#123;</span><br><span class="line">  host     : config.database.HOST,</span><br><span class="line">  user     : config.database.USERNAME,</span><br><span class="line">  password : config.database.PASSWORD,</span><br><span class="line">  database : config.database.DATABASE</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> query = <span class="function"><span class="keyword">function</span>(<span class="params"> sql, values </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class="line">    pool.getConnection(<span class="function"><span class="keyword">function</span>(<span class="params">err, connection</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        reject( err )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        connection.query(sql, values, ( err, rows) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> ( err ) &#123;</span><br><span class="line">            reject( err )</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve( rows )</span><br><span class="line">          &#125;</span><br><span class="line">          connection.release()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// let query = function( sql, values ) &#123;</span></span><br><span class="line"><span class="comment">// pool.getConnection(function(err, connection) &#123;</span></span><br><span class="line"><span class="comment">//   // 使用连接</span></span><br><span class="line"><span class="comment">//   connection.query( sql,values, function(err, rows) &#123;</span></span><br><span class="line"><span class="comment">//     // 使用连接执行查询</span></span><br><span class="line"><span class="comment">//     console.log(rows)</span></span><br><span class="line"><span class="comment">//     connection.release();</span></span><br><span class="line"><span class="comment">//     //连接不再使用，返回到连接池</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> users =</span><br><span class="line">    <span class="string">`create table if not exists users(</span></span><br><span class="line"><span class="string">     id INT NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="string">     name VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     pass VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     avator VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     moment VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     PRIMARY KEY ( id )</span></span><br><span class="line"><span class="string">    );`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> posts =</span><br><span class="line">    <span class="string">`create table if not exists posts(</span></span><br><span class="line"><span class="string">     id INT NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="string">     name VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     title TEXT(0) NOT NULL,</span></span><br><span class="line"><span class="string">     content TEXT(0) NOT NULL,</span></span><br><span class="line"><span class="string">     md TEXT(0) NOT NULL,</span></span><br><span class="line"><span class="string">     uid VARCHAR(40) NOT NULL,</span></span><br><span class="line"><span class="string">     moment VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     comments VARCHAR(200) NOT NULL DEFAULT '0',</span></span><br><span class="line"><span class="string">     pv VARCHAR(40) NOT NULL DEFAULT '0',</span></span><br><span class="line"><span class="string">     avator VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     PRIMARY KEY ( id )</span></span><br><span class="line"><span class="string">    );`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> comment =</span><br><span class="line">    <span class="string">`create table if not exists comment(</span></span><br><span class="line"><span class="string">     id INT NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="string">     name VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     content TEXT(0) NOT NULL,</span></span><br><span class="line"><span class="string">     moment VARCHAR(40) NOT NULL,</span></span><br><span class="line"><span class="string">     postid VARCHAR(40) NOT NULL,</span></span><br><span class="line"><span class="string">     avator VARCHAR(100) NOT NULL,</span></span><br><span class="line"><span class="string">     PRIMARY KEY ( id )</span></span><br><span class="line"><span class="string">    );`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> createTable = <span class="function"><span class="keyword">function</span>(<span class="params"> sql </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> query( sql, [] )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建表</span></span><br><span class="line">createTable(users)</span><br><span class="line">createTable(posts)</span><br><span class="line">createTable(comment)</span><br><span class="line"><span class="comment">// 注册用户</span></span><br><span class="line"><span class="keyword">let</span> insertData = <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">"insert into users set name=?,pass=?,avator=?,moment=?;"</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql, value )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line"><span class="keyword">let</span> deleteUserData = <span class="function"><span class="keyword">function</span>(<span class="params"> name </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`delete from users where name="<span class="subst">$&#123;name&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 查找用户</span></span><br><span class="line"><span class="keyword">let</span> findUserData = <span class="function"><span class="keyword">function</span>(<span class="params"> name </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from users where name="<span class="subst">$&#123;name&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 发表文章</span></span><br><span class="line"><span class="keyword">let</span> insertPost = <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">"insert into posts set name=?,title=?,content=?,md=?,uid=?,moment=?,avator=?;"</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql, value )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新文章评论数</span></span><br><span class="line"><span class="keyword">let</span> updatePostComment = <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">"update posts set comments=? where id=?"</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql, value )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新浏览数</span></span><br><span class="line"><span class="keyword">let</span> updatePostPv = <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">"update posts set pv=? where id=?"</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql, value )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发表评论</span></span><br><span class="line"><span class="keyword">let</span> insertComment = <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">"insert into comment set name=?,content=?,moment=?,postid=?,avator=?;"</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql, value )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过名字查找用户</span></span><br><span class="line"><span class="keyword">let</span> findDataByName = <span class="function"><span class="keyword">function</span> (<span class="params"> name </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from users where name="<span class="subst">$&#123;name&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过文章的名字查找用户</span></span><br><span class="line"><span class="keyword">let</span> findDataByUser = <span class="function"><span class="keyword">function</span> (<span class="params"> name </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from posts where name="<span class="subst">$&#123;name&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过文章id查找</span></span><br><span class="line"><span class="keyword">let</span> findDataById = <span class="function"><span class="keyword">function</span> (<span class="params"> id </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from posts where id="<span class="subst">$&#123;id&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过评论id查找</span></span><br><span class="line"><span class="keyword">let</span> findCommentById = <span class="function"><span class="keyword">function</span> (<span class="params"> id </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * FROM comment where postid="<span class="subst">$&#123;id&#125;</span>";`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有文章</span></span><br><span class="line"><span class="keyword">let</span> findAllPost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">` select * FROM posts;`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 查询分页文章</span></span><br><span class="line"><span class="keyword">let</span> findPostByPage = <span class="function"><span class="keyword">function</span> (<span class="params">page</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">` select * FROM posts limit <span class="subst">$&#123;(page<span class="number">-1</span>)*<span class="number">10</span>&#125;</span>,10;`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 查询个人分页文章</span></span><br><span class="line"><span class="keyword">let</span> findPostByUserPage = <span class="function"><span class="keyword">function</span> (<span class="params">name,page</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">` select * FROM posts where name="<span class="subst">$&#123;name&#125;</span>" order by id desc limit <span class="subst">$&#123;(page<span class="number">-1</span>)*<span class="number">10</span>&#125;</span>,10 ;`</span></span><br><span class="line">  <span class="keyword">return</span> query( _sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新修改文章</span></span><br><span class="line"><span class="keyword">let</span> updatePost = <span class="function"><span class="keyword">function</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`update posts set  title=?,content=?,md=? where id=?`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql,values)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除文章</span></span><br><span class="line"><span class="keyword">let</span> deletePost = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`delete from posts where id = <span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除评论</span></span><br><span class="line"><span class="keyword">let</span> deleteComment = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`delete from comment where id=<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除所有评论</span></span><br><span class="line"><span class="keyword">let</span> deleteAllPostComment = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`delete from comment where postid=<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 查找评论数</span></span><br><span class="line"><span class="keyword">let</span> findCommentLength = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select content from comment where postid in (select id from posts where id=<span class="subst">$&#123;id&#125;</span>)`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滚动无限加载数据</span></span><br><span class="line"><span class="keyword">let</span> findPageById = <span class="function"><span class="keyword">function</span>(<span class="params">page</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from posts limit <span class="subst">$&#123;(page<span class="number">-1</span>)*<span class="number">5</span>&#125;</span>,5;`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 评论分页</span></span><br><span class="line"><span class="keyword">let</span> findCommentByPage = <span class="function"><span class="keyword">function</span>(<span class="params">page,postId</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _sql = <span class="string">`select * from comment where postid=<span class="subst">$&#123;postId&#125;</span> order by id desc limit <span class="subst">$&#123;(page<span class="number">-1</span>)*<span class="number">10</span>&#125;</span>,10;`</span></span><br><span class="line">  <span class="keyword">return</span> query(_sql)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	query,</span><br><span class="line">	createTable,</span><br><span class="line">	insertData,</span><br><span class="line">  	deleteUserData,</span><br><span class="line">  	findUserData,</span><br><span class="line">	findDataByName,</span><br><span class="line">  	insertPost,</span><br><span class="line">  	findAllPost,</span><br><span class="line">  	findPostByPage,</span><br><span class="line">	findPostByUserPage,</span><br><span class="line">	findDataByUser,</span><br><span class="line">	findDataById,</span><br><span class="line">	insertComment,</span><br><span class="line">	findCommentById,</span><br><span class="line">	updatePost,</span><br><span class="line">	deletePost,</span><br><span class="line">	deleteComment,</span><br><span class="line">	findCommentLength,</span><br><span class="line">	updatePostComment,</span><br><span class="line">	deleteAllPostComment,</span><br><span class="line">	updatePostPv,</span><br><span class="line">	findPageById,</span><br><span class="line">	findCommentByPage</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是我们建的表：<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/image-bed/images/20200225174355.png" alt="数据库表"></p>
<p>现在感觉有点枯燥，那我们先来实现一下注册吧</p>
<h2 id="实现注册页面"><a href="#实现注册页面" class="headerlink" title="实现注册页面"></a>实现注册页面</h2><p>routers/singup.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line"><span class="keyword">const</span> userModel = <span class="built_in">require</span>(<span class="string">'../lib/mysql.js'</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">'md5'</span>)</span><br><span class="line"><span class="keyword">const</span> checkNotLogin = <span class="built_in">require</span>(<span class="string">'../middlewares/check.js'</span>).checkNotLogin</span><br><span class="line"><span class="keyword">const</span> checkLogin = <span class="built_in">require</span>(<span class="string">'../middlewares/check.js'</span>).checkLogin</span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="comment">// 注册页面</span></span><br><span class="line">router.get(<span class="string">'/signup'</span>, <span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> checkNotLogin(ctx)</span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">'signup'</span>, &#123;</span><br><span class="line">        session: ctx.session,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>

<p>使用get方式得到’/signup’页面，然后渲染signup模板，这里我们还没有在写signup.ejs</p>
<p>views/signup.ejs</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form create"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span> <span class="attr">class</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>重复密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请确认密码"</span> <span class="attr">class</span>=<span class="string">"repeatpass"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"repeatpass"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>上传头像：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"avator"</span> <span class="attr">id</span>=<span class="string">"avator"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"avatorVal"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"preview"</span> <span class="attr">alt</span>=<span class="string">"预览头像"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"submit"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们先安装supervisor</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i supervisor -g</span><br></pre></td></tr></table></figure>
<p>supervisor的作用是会监听文件的变化，而我们修改文件之后不必去重启程序</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">supervisor --harmony index</span><br></pre></td></tr></table></figure>
<p>现在访问 localhost:3000/signup 看看效果吧。注意数据库一定要是开启的状态，不能关闭</p>
<h2 id="完善注册功能"><a href="#完善注册功能" class="headerlink" title="完善注册功能"></a>完善注册功能</h2><p>首先我们来完善一下样式吧，稍微美化一下<br>public/index.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-tag">header</span>,</span><br><span class="line"><span class="selector-tag">ul</span>,</span><br><span class="line"><span class="selector-tag">li</span>,</span><br><span class="line"><span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-tag">div</span>,</span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">span</span>,</span><br><span class="line"><span class="selector-tag">h3</span>,</span><br><span class="line"><span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">blockquote</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span>,<span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">list-style-type</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">header</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">header</span> <span class="selector-class">.user_right</span>&#123;</span><br><span class="line">    <span class="attribute">float</span>: right</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">header</span> <span class="selector-class">.user_right</span> <span class="selector-class">.active</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">5px</span> <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">header</span> <span class="selector-class">.user_name</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user_name</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.has_user</span> <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-class">.has_user</span> <span class="selector-tag">span</span>,</span><br><span class="line"><span class="selector-class">.none_user</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.has_user</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,<span class="selector-class">.has_user</span> <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">5px</span> <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.posts</span>&#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>; </span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> &gt; <span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-class">.comment_pv</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-class">.author</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-class">.author</span> <span class="selector-tag">span</span>&#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> &gt; <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f2f2f2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> &gt; <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">pre</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> &gt; <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> &gt; <span class="selector-tag">li</span> + <span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-tag">li</span> <span class="selector-class">.title</span> <span class="selector-tag">span</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-tag">li</span> <span class="selector-class">.title</span>&#123;</span><br><span class="line">     <span class="attribute">margin-left</span>: <span class="number">40px</span>;</span><br><span class="line">     <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">     <span class="attribute">color</span>: <span class="number">#222</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-class">.userAvator</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#f2f2f2</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#f2f2f2</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.userMsg</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.userMsg</span> <span class="selector-tag">span</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">color</span>:<span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.posts</span> <span class="selector-tag">li</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.spost</span> <span class="selector-class">.comment_pv</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.spost</span> <span class="selector-class">.edit</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.spost</span> <span class="selector-class">.edit</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.comment_wrap</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.submit</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span> ;</span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.submit</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#5FB878</span>;</span><br><span class="line">    <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#5FB878</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.comment_list</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_lists</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f2f2f2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_lists</span> + <span class="selector-class">.cmt_lists</span>&#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_content</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_detail</span>&#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">48px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_content</span> <span class="selector-tag">img</span>&#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* .cmt_content:after &#123;</span></span><br><span class="line"><span class="comment">    content: '#content';</span></span><br><span class="line"><span class="comment">    position: absolute;</span></span><br><span class="line"><span class="comment">    top: 5px;</span></span><br><span class="line"><span class="comment">    right: 5px;</span></span><br><span class="line"><span class="comment">    color: #aaa;</span></span><br><span class="line"><span class="comment">    font-size: 13px;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-class">.cmt_name</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cmt_name</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#1E9FFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cmt_time</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#aaa</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.form</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">textarea</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">padding</span>:<span class="number">10px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;   </span><br><span class="line">	<span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d7dde4</span>;</span><br><span class="line">    <span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">    <span class="attribute">resize</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">textarea</span><span class="selector-id">#spContent</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">98%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tips</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ec5051</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.form</span> <span class="selector-tag">img</span><span class="selector-class">.preview</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">margin-top</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">35px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">7px</span>;	</span><br><span class="line">	<span class="attribute">border-radius</span>: <span class="number">4px</span>;   </span><br><span class="line">	<span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#d7dde4</span>;</span><br><span class="line">	<span class="attribute">-webkit-appearance</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:focus</span>,<span class="selector-tag">textarea</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">51</span>,<span class="number">153</span>,<span class="number">255</span>,.<span class="number">2</span>);</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#5cadff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-pseudo">:hover</span>,<span class="selector-tag">input</span><span class="selector-pseudo">:active</span>,<span class="selector-tag">textarea</span><span class="selector-pseudo">:hover</span>,<span class="selector-tag">textarea</span><span class="selector-pseudo">:active</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#5cadff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.create</span> <span class="selector-tag">label</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.comment_wrap</span> <span class="selector-tag">form</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">85px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.delete_comment</span>,</span><br><span class="line"><span class="selector-class">.delete_post</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.delete_comment</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.delete_post</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ec5051</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.disabled</span>&#123;</span><br><span class="line">    <span class="attribute">user-select</span>: none;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.error</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ec5051</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.success</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#1E9FFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">    <span class="attribute">margin</span>:<span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.message</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.7</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-bottom-left-radius</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99999</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.markdown</span> <span class="selector-tag">pre</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">overflow-x</span>: auto;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5em</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#F0F0F0</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.markdown</span> <span class="selector-tag">blockquote</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#6a737d</span>;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">0.25em</span> solid <span class="number">#dfe2e5</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.markdown</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">list-style</span>: circle;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们再把模板引擎的header和footer独立出来</p>
<p>/views/header.ejs<br>顺便引入index.css和jq</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>koa2-blog<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"http://www.wclimb.site/images/avatar.png"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/index.css"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="function"><span class="keyword">function</span> <span class="title">fade</span><span class="params">(txt)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'.message'</span>).text(txt)</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'.message'</span>).animate(&#123;</span></span><br><span class="line">				top:0</span><br><span class="line">			&#125;)</span><br><span class="line"><span class="actionscript">			setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">				$(<span class="string">'.message'</span>).animate(&#123;</span></span><br><span class="line"><span class="actionscript">					top: <span class="string">'-100%'</span></span></span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;,1500)</span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'.signout'</span>).click(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">				$.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">					url: <span class="string">"/signout"</span>,</span></span><br><span class="line"><span class="actionscript">					type: <span class="string">"GET"</span>,</span></span><br><span class="line"><span class="actionscript">					cache: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">					dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">					success: <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> </span>&#123;</span></span><br><span class="line">						if (msg) &#123;</span><br><span class="line"><span class="actionscript">							fade(<span class="string">'登出成功'</span>)</span></span><br><span class="line"><span class="javascript">							setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">								<span class="built_in">window</span>.location.href = <span class="string">"/posts"</span></span></span><br><span class="line">							&#125;,1500)	</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line"><span class="actionscript">					error: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">						alert(<span class="string">'异常'</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user_name"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">session.user</span>)&#123; %&gt;</span></span><br><span class="line">				 Hello,<span class="tag">&lt;<span class="name">%=</span> <span class="attr">session.user</span> %&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(!<span class="attr">session.user</span>)&#123; %&gt;</span></span><br><span class="line">				欢迎注册登录^_^</span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"message"</span>&gt;</span>登录成功<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user_right"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span>  <span class="attr">if</span>(<span class="attr">session.user</span>)&#123; %&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"has_user"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"__blank"</span> <span class="attr">href</span>=<span class="string">"https://github.com/wclimb/Koa2-blog"</span>&gt;</span>GitHub<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'all'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/posts"</span>&gt;</span>全部文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/posts"</span>&gt;</span>全部文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'my'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/posts?author=&lt;%= session.user %&gt;"</span>&gt;</span>我的文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/posts?author=&lt;%= session.user %&gt;"</span>&gt;</span>我的文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'create'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/create"</span>&gt;</span>发表文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/create"</span>&gt;</span>发表文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">					</span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"signout"</span>&gt;</span>登出<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(!<span class="attr">session.user</span>)&#123; %&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"none_user has_user"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"__blank"</span> <span class="attr">href</span>=<span class="string">"https://github.com/wclimb/Koa2-blog"</span>&gt;</span>GitHub<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'all'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/posts"</span>&gt;</span>全部文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/posts"</span>&gt;</span>全部文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'signup'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/signup"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/signup"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">type</span> == <span class="string">'signin'</span>)&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/signin"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/signin"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">%</span> &#125;%&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先我们看到用到了session.user，这个值从哪来呢？请看下面的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册页面</span></span><br><span class="line">router.get(<span class="string">'/signup'</span>, <span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> checkNotLogin(ctx)</span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">'signup'</span>, &#123;</span><br><span class="line">        session: ctx.session,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们可以看到我们向模板传了一个session值，session:ctx.session，这个值存取的就是用户的信息，包括用户名、登录之后的id等，session一般是你关闭浏览器就过期了，等于下次打开浏览器的时候就得重新登录了，用if判断他存不存在，就可以知道用户是否需要登录，如果不存在用户，则只显示全部文章 注册 登录 ,如果session.user存在则有登出的按钮。</p>
<p>在上面我们会看到我用了另外一个if判断，判断type类型，这样做的目的是比如我们登录注册页面，注册页面的导航会高亮，其实就是添加了<code>class：active</code>;<br>之后我们每个ejs文件的头部会这样写<code>&lt;%- include(&quot;header&quot;,{type:&#39;signup&#39;}) %&gt;</code> 登录页面则是<code>&lt;%- include(&quot;header&quot;,{type:&#39;signin&#39;}) %&gt;</code>。</p>
<p>修改views/signup.ejs</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">include</span>("<span class="attr">header</span>",&#123;<span class="attr">type:</span>'<span class="attr">signup</span>'&#125;) %&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form create"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span> <span class="attr">class</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>重复密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"请确认密码"</span> <span class="attr">class</span>=<span class="string">"repeatpass"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"repeatpass"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">label</span>&gt;</span>上传头像：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"avator"</span> <span class="attr">id</span>=<span class="string">"avator"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"avatorVal"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"preview"</span> <span class="attr">alt</span>=<span class="string">"预览头像"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"submit"</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">		$(<span class="built_in">window</span>).keyup(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">			<span class="comment">//console.log(e.keyCode)</span></span></span><br><span class="line">			if (e.keyCode == 13) &#123;</span><br><span class="line"><span class="javascript">				$(<span class="string">'.submit'</span>).click()</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line"><span class="javascript">		$(<span class="string">'#avator'</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">			<span class="keyword">if</span> (<span class="keyword">this</span>.files.length != <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="actionscript">				<span class="keyword">var</span> file = <span class="keyword">this</span>.files[<span class="number">0</span>],</span></span><br><span class="line"><span class="actionscript">					reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line">				if (!reader) &#123;</span><br><span class="line"><span class="actionscript">					<span class="keyword">this</span>.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="actionscript">					<span class="keyword">return</span>;</span></span><br><span class="line">				&#125;;</span><br><span class="line"><span class="javascript">				<span class="built_in">console</span>.log(file.size)</span></span><br><span class="line">				if (file.size &gt;= 1024 * 1024 / 2) &#123;</span><br><span class="line"><span class="actionscript">					fade(<span class="string">"请上传小于512kb的图片!"</span>)</span></span><br><span class="line"><span class="actionscript">					<span class="keyword">return</span> </span></span><br><span class="line">				&#125;</span><br><span class="line"><span class="actionscript">				reader.onload = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">					<span class="keyword">this</span>.value = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">'form .preview'</span>).attr(<span class="string">'src'</span>, e.target.result)</span></span><br><span class="line"><span class="javascript">					$(<span class="string">'form .preview'</span>).fadeIn()</span></span><br><span class="line"><span class="javascript">					$(<span class="string">'#avatorVal'</span>).val(e.target.result)</span></span><br><span class="line">				&#125;;</span><br><span class="line">				reader.readAsDataURL(file);</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;)</span><br><span class="line"><span class="javascript">		$(<span class="string">'.submit'</span>).click(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="actionscript">			<span class="comment">// console.log($('.form').serialize())</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> ($(<span class="string">'input[name=name]'</span>).val().trim() == <span class="string">''</span>) &#123;</span></span><br><span class="line"><span class="actionscript">				fade(<span class="string">'请输入用户名！'</span>)</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>($(<span class="string">'input[name=name]'</span>).val().match(<span class="regexp">/[&lt;'"&gt;]/g</span>))&#123;</span></span><br><span class="line"><span class="actionscript">				fade(<span class="string">'请输入合法字符！'</span>)</span></span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>($(<span class="string">'#avatorVal'</span>).val() == <span class="string">''</span>)&#123;</span></span><br><span class="line"><span class="actionscript">				fade(<span class="string">'请上传头像！'</span>)</span></span><br><span class="line"><span class="actionscript">			&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">				$.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">					url: <span class="string">"/signup"</span>,</span></span><br><span class="line">					data: &#123;</span><br><span class="line"><span class="javascript">						name: $(<span class="string">'input[name=name]'</span>).val(),</span></span><br><span class="line"><span class="javascript">						password: $(<span class="string">'input[name=password]'</span>).val(),</span></span><br><span class="line"><span class="javascript">						repeatpass: $(<span class="string">'input[name=repeatpass]'</span>).val(),</span></span><br><span class="line"><span class="javascript">						avator: $(<span class="string">'#avatorVal'</span>).val(),</span></span><br><span class="line">					&#125;,</span><br><span class="line"><span class="actionscript">					type: <span class="string">"POST"</span>,</span></span><br><span class="line"><span class="actionscript">					cache: <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">					dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">					success: <span class="function"><span class="keyword">function</span> <span class="params">(msg)</span> </span>&#123;</span></span><br><span class="line">					   if (msg.data == 1) &#123;           		</span><br><span class="line"><span class="javascript">						   $(<span class="string">'input'</span>).val(<span class="string">''</span>)</span></span><br><span class="line"><span class="actionscript">						   fade(<span class="string">'用户名存在'</span>)</span></span><br><span class="line">					   &#125;</span><br><span class="line"><span class="actionscript">					   <span class="keyword">else</span> <span class="keyword">if</span> (msg.data == <span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="actionscript">							fade(<span class="string">'请输入重复的密码'</span>)	               		</span></span><br><span class="line">					   &#125;</span><br><span class="line"><span class="actionscript">					   <span class="keyword">else</span> <span class="keyword">if</span>(msg.data == <span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="actionscript">							fade(<span class="string">'注册成功'</span>)</span></span><br><span class="line"><span class="javascript">							setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">								<span class="built_in">window</span>.location.href=<span class="string">"/signin"</span>	  </span></span><br><span class="line">							&#125;,1000)</span><br><span class="line">					   	&#125;</span><br><span class="line">					&#125;,</span><br><span class="line"><span class="actionscript">					error: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">						alert(<span class="string">'异常'</span>);</span></span><br><span class="line">	</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)			</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">footer</span> %&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改routers/signup.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// post 注册</span></span><br><span class="line">router.post(<span class="string">'/signup'</span>, <span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">//console.log(ctx.request.body)</span></span><br><span class="line">    <span class="keyword">let</span> user = &#123;</span><br><span class="line">        name: ctx.request.body.name,</span><br><span class="line">        pass: ctx.request.body.password,</span><br><span class="line">        repeatpass: ctx.request.body.repeatpass,</span><br><span class="line">        avator: ctx.request.body.avator</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> userModel.findDataByName(user.name)</span><br><span class="line">        .then(<span class="keyword">async</span> (result) =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(result)</span><br><span class="line">            <span class="keyword">if</span> (result.length) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'用户已经存在'</span>)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="comment">//处理err</span></span><br><span class="line">                    <span class="built_in">console</span>.log(error)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 用户存在</span></span><br><span class="line">                ctx.body = &#123;</span><br><span class="line">                    data: <span class="number">1</span></span><br><span class="line">                &#125;;;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user.pass !== user.repeatpass || user.pass === <span class="string">''</span>) &#123;</span><br><span class="line">                ctx.body = &#123;</span><br><span class="line">                    data: <span class="number">2</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ctx.session.user=ctx.request.body.name   </span></span><br><span class="line">                <span class="keyword">let</span> base64Data = user.avator.replace(<span class="regexp">/^data:image\/\w+;base64,/</span>, <span class="string">""</span>);</span><br><span class="line">                <span class="keyword">let</span> dataBuffer = <span class="keyword">new</span> Buffer(base64Data, <span class="string">'base64'</span>);</span><br><span class="line">                <span class="keyword">let</span> getName = <span class="built_in">Number</span>(<span class="built_in">Math</span>.random().toString().substr(<span class="number">3</span>)).toString(<span class="number">36</span>) + <span class="built_in">Date</span>.now()</span><br><span class="line">                <span class="keyword">await</span> fs.writeFile(<span class="string">'./public/images/'</span> + getName + <span class="string">'.png'</span>, dataBuffer, err =&gt; &#123; </span><br><span class="line">                    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'头像上传成功'</span>) </span><br><span class="line">                &#125;);            </span><br><span class="line">                <span class="keyword">await</span> userModel.insertData([user.name, md5(user.pass), getName, moment().format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>)])</span><br><span class="line">                    .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">'注册成功'</span>,res)</span><br><span class="line">                        <span class="comment">//注册成功</span></span><br><span class="line">                        ctx.body = &#123;</span><br><span class="line">                            data: <span class="number">3</span></span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>

<ul>
<li>我们使用md5实现密码加密，长度是32位的</li>
<li>使用我们之前说的bodyParse来解析提交的数据，通过ctx.request.body得到</li>
<li>我们引入了数据库的操作 findDataByName和insertData，因为之前我们在/lib/mysql.js中已经把他们写好，并暴露出来了。意思是先从数据库里面查找注册的用户名，如果找到了证明该用户名已经被注册过了，如果没有找到则使用insertData增加到数据库中</li>
<li>ctx.body 是我们通过ajax提交之后给页面返回的数据，比如提交ajax成功之后msg.data=1的时候就代表用户存在，msg.data出现在后面的signup.ejs模板ajax请求中</li>
<li>上传头像之前要新建好文件夹，我们ajax发送的是base64的格式，然后使用fs.writeFile来生成图片</li>
</ul>
<h2 id="模板引擎ejs"><a href="#模板引擎ejs" class="headerlink" title="模板引擎ejs"></a>模板引擎ejs</h2><p>我们使用的是ejs，语法可以见ejs<br>之前我们写了这么一段代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">'/signup'</span>,<span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">	<span class="keyword">await</span> ctx.render(<span class="string">'signup'</span>,&#123;</span><br><span class="line">		session:ctx.session,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里就用到了ejs所需的session 我们通过渲染signup.ejs模板，将值ctx.session赋值给session，之后我们就可以在signup.ejs中使用了<br>ejs的常用标签为：</p>
<ul>
<li><code>&lt;% code %&gt;</code>：运行 JavaScript 代码，不输出</li>
<li><code>&lt;%= code %&gt;</code>：显示转义后的 HTML内容</li>
<li><code>&lt;%- code %&gt;</code>：显示原始 HTML 内容</li>
</ul>
<p><code>&lt;%= code %&gt;</code>和<code>&lt;%- code %&gt;</code>的区别在于：<br><code>&lt;%= code %&gt;</code>不管你写什么都会原样输出，比如code为 <code>&lt;strong&gt;hello&lt;/strong&gt;</code>的时候 <code>&lt;%= code %&gt;</code> 会显示<code>&lt;strong&gt;hello&lt;/strong&gt;</code><br>而&lt;%- code %&gt;则显示<strong>hello</strong>.</p>
<p>完整源码及部署教程：<a href="https://github.com/growvv/Koa2-blog" target="_blank" rel="noopener">https://github.com/growvv/Koa2-blog</a></p>
<p>参考链接： <a href="http://www.wclimb.site/2017/07/12/Node-Koa2-Mysql-%E6%90%AD%E5%BB%BA%E7%AE%80%E6%98%93%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">wclimb-Node+Koa2+Mysql 搭建简易博客</a></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>Koa2</tag>
      </tags>
  </entry>
  <entry>
    <title>如何在VS Code中开发SCF</title>
    <url>/scf-start/</url>
    <content><![CDATA[<p>首先，安装VScode插件-Tencent Serverless Toolkit for VS Code，使用该插件可以轻松地编辑、调试、上传。</p>
<a id="more"></a>

<h2 id="1-配置插件"><a href="#1-配置插件" class="headerlink" title="1. 配置插件"></a>1. 配置插件</h2><p>单击左侧的<code>腾讯云图标</code>，根据提示输入账号的 APPID，SecretId 及 SecretKey 信息。<br>为提升函数上传效率，您可以在 VS Code 的Setting中开启 COS 上传 。（但在部署频次、部署包很大时，可能会产生 COS 计费。）</p>
<h2 id="2-创建函数"><a href="#2-创建函数" class="headerlink" title="2. 创建函数"></a>2. 创建函数</h2><p>单击本地函数上的<code>加法符号</code>初始化项目，函数创建成功后，会跳转到工作区打开函数的入口文件。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    print(str(event))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello world"</span></span><br></pre></td></tr></table></figure>

<h2 id="3-本地测试"><a href="#3-本地测试" class="headerlink" title="3. 本地测试"></a>3. 本地测试</h2><p>进入 Tencent Serverless 插件，单击本地函数列表目标函数上的<code>运行符号</code>.</p>
<h2 id="4-函数部署"><a href="#4-函数部署" class="headerlink" title="4. 函数部署"></a>4. 函数部署</h2><p>由于我们的函数是基于 API 网关触发，所以需要在模板文件里（template.yaml）添加 API 网关触发事件。<br>取消APIGW类型的注释，即</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Resources:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">Type:</span> <span class="string">'TencentCloud::Serverless::Namespace'</span></span><br><span class="line">    <span class="attr">hello_world:</span></span><br><span class="line">      <span class="attr">Properties:</span></span><br><span class="line">        <span class="attr">CodeUri:</span> <span class="string">./</span></span><br><span class="line">        <span class="attr">Description:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">template</span> <span class="string">function</span></span><br><span class="line">        <span class="attr">Environment:</span></span><br><span class="line">          <span class="attr">Variables:</span></span><br><span class="line">            <span class="attr">ENV_FIRST:</span> <span class="string">env1</span></span><br><span class="line">            <span class="attr">ENV_SECOND:</span> <span class="string">env2</span></span><br><span class="line">        <span class="attr">Handler:</span> <span class="string">index.main_handler</span></span><br><span class="line">        <span class="attr">MemorySize:</span> <span class="number">128</span></span><br><span class="line">        <span class="attr">Timeout:</span> <span class="number">3</span></span><br><span class="line">        <span class="comment"># Role: SCF_QCSExcuteRole</span></span><br><span class="line">        <span class="attr">Runtime:</span> <span class="string">Python3.6</span></span><br><span class="line">        <span class="comment"># VpcConfig:</span></span><br><span class="line">        <span class="comment">#   VpcId: 'vpc-qdqc5k2p'</span></span><br><span class="line">        <span class="comment">#   SubnetId: 'subnet-pad6l61i'</span></span><br><span class="line">        <span class="attr">Events:</span></span><br><span class="line">        <span class="comment">#   timer:</span></span><br><span class="line">        <span class="comment">#     Type: Timer</span></span><br><span class="line">        <span class="comment">#     Properties:</span></span><br><span class="line">        <span class="comment">#       CronExpression: '*/5 * * * *'</span></span><br><span class="line">        <span class="comment">#       Enable: True</span></span><br><span class="line">        <span class="comment">#   cli-appid.cos.ap-beijing.myqcloud.com: # full bucket name</span></span><br><span class="line">        <span class="comment">#     Type: COS</span></span><br><span class="line">        <span class="comment">#     Properties:</span></span><br><span class="line">        <span class="comment">#       Bucket: cli-appid.cos.ap-beijing.myqcloud.com</span></span><br><span class="line">        <span class="comment">#       Filter:</span></span><br><span class="line">        <span class="comment">#         Prefix: filterdir/</span></span><br><span class="line">        <span class="comment">#         Suffix: .jpg</span></span><br><span class="line">        <span class="comment">#       Events: cos:ObjectCreated:*</span></span><br><span class="line">        <span class="comment">#       Enable: True</span></span><br><span class="line">        <span class="comment">#   topic:            # topic name</span></span><br><span class="line">        <span class="comment">#     Type: CMQ</span></span><br><span class="line">        <span class="comment">#     Properties:</span></span><br><span class="line">        <span class="comment">#       Name: qname</span></span><br><span class="line">          <span class="attr">hello_world_apigw:</span>  <span class="comment"># $&#123;FunctionName&#125; + '_apigw'</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">APIGW</span></span><br><span class="line">            <span class="attr">Properties:</span></span><br><span class="line">              <span class="attr">StageName:</span> <span class="string">release</span></span><br><span class="line">              <span class="attr">ServiceId:</span> </span><br><span class="line">              <span class="attr">HttpMethod:</span> <span class="string">ANY</span></span><br><span class="line">      <span class="attr">Type:</span> <span class="string">'TencentCloud::Serverless::Function'</span></span><br><span class="line"><span class="attr">Globals:</span></span><br><span class="line">  <span class="attr">Function:</span></span><br><span class="line">    <span class="attr">Timeout:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p> 进入 Tencent Serverless 插件，单击击本地函数列表目标函数上的<code>上传图标</code>。</p>
<ul>
<li>可以在控制台输出信息中找到url访问，例如<a href="https://service-l9rrldn2-1300738167.gz.apigw.tencentcs.com/release/hello_world" target="_blank" rel="noopener">https://service-l9rrldn2-1300738167.gz.apigw.tencentcs.com/release/hello_world</a></li>
<li>可以将输出信息中的service id加到yaml文件中，之后部署就不会再创建新的 API 网关</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://marketplace.visualstudio.com/items?itemName=tencentcloud.tencent-cloud-vscode-toolkit" target="_blank" rel="noopener">Tencent Serverless Toolkit for VS Code插件官方文档</a></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Hexo 框架 Next 主题添加自定义 Page</title>
    <url>/new-page/</url>
    <content><![CDATA[<p>由于自己最近做了各种杂七杂八的网站，有时自己想访问都忘记网址，所以想汇总一下，放到博客主页。</p>
<p>放到友链处显然不太合适，考虑新建一个Page.</p>
<p><a href="https://rogn.top/links/">查看效果</a></p>
<a id="more"></a>

<h2 id="一、步骤"><a href="#一、步骤" class="headerlink" title="一、步骤"></a>一、步骤</h2><h3 id="1-新增links"><a href="#1-新增links" class="headerlink" title="1.新增links"></a>1.新增links</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new page links</span><br></pre></td></tr></table></figure>

<p>也可在<code>source</code>目录下手动创建<code>links</code>目录（还需要手动创建<code>index.md</code>文件）</p>
<h2 id="2-配置menu"><a href="#2-配置menu" class="headerlink" title="2.配置menu"></a>2.配置menu</h2><p>主题配置文件<code>_config.yml</code>中<code>menu</code>下添加：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">links: /links/ || link</span><br></pre></td></tr></table></figure>

<p><code>/themes/next/languages/zh-Hans.yml</code>文件中<code>menu</code>下增加中文描述：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">links: 友链</span><br></pre></td></tr></table></figure>

<h2 id="3-编辑md文件"><a href="#3-编辑md文件" class="headerlink" title="3.编辑md文件"></a>3.编辑md文件</h2><p>打开<code>source/links</code>下的<code>index.md</code>文件编辑。</p>
<p>若你想关闭评论，在头部设置<code>comments: false</code></p>
<h2 id="二、有待改进"><a href="#二、有待改进" class="headerlink" title="二、有待改进"></a>二、有待改进</h2><ol>
<li>整个好看点的界面</li>
<li>有人跟我换友链吗？</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://www.playpi.org/2017050701.html" target="_blank" rel="noopener">虾丸派-Hexo 框架 Next 主题添加自定义 Page</a></li>
<li><a href="https://www.jianshu.com/p/ef110f36650b" target="_blank" rel="noopener">北辰-Hexo NexT主题自定义友链页面</a></li>
</ol>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>使用腾讯SCF+onedrive免费搭建5T个人网盘</title>
    <url>/personal-pan/</url>
    <content><![CDATA[<p>之前在群友利用OneDrive搭建的网盘看《庆余年》，页面简介、速度流畅，体验很好。</p>
<p>最近看到一个Serverless版搭建教程，于是开始上手。</p>
<p><a href="https://pan.rogn.top/" target="_blank" rel="noopener">效果展示</a></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200208162602.png" alt=""></p>
<a id="more"></a>

<h2 id="一、准备OneDrive账号"><a href="#一、准备OneDrive账号" class="headerlink" title="一、准备OneDrive账号"></a>一、准备OneDrive账号</h2><p>临时邮箱网址：<a href="https://t.odmail.cn/" target="_blank" rel="noopener">https://t.odmail.cn/</a></p>
<p>复制网页中的邮箱然后选择 学生版 or 教师版 在注册,记住，页面不要关闭，待会需要接收验证码</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200208114230.png" alt=""></p>
<p>详见教程见<a href="https://www.mad-coding.cn/2019/08/09/onedrive-oneindex%E6%89%93%E9%80%A0%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98/#0x02-%E6%B3%A8%E5%86%8C365%E9%82%AE%E7%AE%B1" target="_blank" rel="noopener">madcoding-onedrive+oneindex打造属于自己的个人网盘</a>，该教程中推荐的上传工具<a href="https://www.mad-coding.cn/2019/08/09/onedrive-oneindex%E6%89%93%E9%80%A0%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%9B%98/#%E3%80%90%E6%96%B9%E6%B3%95%E4%B8%80-RaiDrive%E3%80%91" target="_blank" rel="noopener">RaiDrive</a>也不错</p>
<h2 id="二、搭建之路"><a href="#二、搭建之路" class="headerlink" title="二、搭建之路"></a>二、搭建之路</h2><p>网上有较完整的教程，主要参考IOIOX大佬的这篇-<a href="https://www.ioiox.com/archives/71.html" target="_blank" rel="noopener">腾讯云SCF云函数无服务器部署OneDrive分享网盘</a></p>
<p>唯一需要纠正的是：配置网盘（即那几个环境变量）步骤要放到部署网盘前，不然最后OneDrive页面跳不出来。</p>
<h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><ol>
<li>速度没有之前体验的那么快，是OneDrive账号的原因吗？</li>
<li>UI有待改进</li>
<li>发掘好用的上传工具</li>
</ol>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>用七牛云搭建免费图床</title>
    <url>/qiniu-img-bed/</url>
    <content><![CDATA[<p><strong>警告</strong>：<font color=red>该方案仅作测试使用，因为七牛云提供的测试域名每隔一个月会自动变更，导致图片链接失效。</font></p>
<p>之前用GitHub搭建了一个图床，套上CDN速度也还行。但是一直想体验专业的云存储服务，七牛云提供10G免费空间，遂体验一番。</p>
<a id="more"></a>

<h2 id="一、注册七牛云并创建对象存储"><a href="#一、注册七牛云并创建对象存储" class="headerlink" title="一、注册七牛云并创建对象存储"></a>一、注册七牛云并创建对象存储</h2><ol>
<li>进入<a href="https://portal.qiniu.com/" target="_blank" rel="noopener">七牛云官网</a>，注册，实名认证（不知道不认证行不行，反正smrz国内已司空见惯）。</li>
<li>创建存储对象。存储空间名称随便取，存储区域选个离得近点的，访问控制选公开，毕竟要能通过外链分享的。<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200207211448.png" alt="存储空间设置"></li>
</ol>
<h2 id="二、配置PicGo"><a href="#二、配置PicGo" class="headerlink" title="二、配置PicGo"></a>二、配置PicGo</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>图片上传管理工具很多，这里推荐PicGo.</p>
<ol>
<li>AK、SK，在个人中心-密钥管理中，是创建七牛云账号时自动生成的密钥，也可以自行创建。 </li>
<li>访问网址，如果没有绑定自定义域名就用它给的测试域名</li>
<li>“z0” | “z1” | “z2” | “na0” | “as0”, // 存储区域编号</li>
<li>网址后缀建议不填（后面会讲）</li>
<li>存储路径可以不填<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200207212355.png" alt="PicGo七牛图床设置"></li>
</ol>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p> 网址后缀建议不填，而是修改PicGo设置–&gt;自定义链接格式，在url后加 <code>?imageslim</code>，能自动对图片压缩，详见<a href="https://developer.qiniu.com/dora/api/1271/image-thin-body-imageslim" target="_blank" rel="noopener">图片瘦身</a>。在上传图片的时候链接格式选Custom即可，不想压缩则选其他。<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200207212603.png" alt="自定义链接"></p>
<h2 id="三、有待改进"><a href="#三、有待改进" class="headerlink" title="三、有待改进"></a>三、有待改进</h2><ol>
<li>有空给域名备个案？</li>
<li>自己写个简单的图片上传工具（electron/chrome扩展/python?），参考链接3中的那个貌似就还不错。</li>
<li>测试域名过期了怎么办？只是外链失效，存储空间中还有，可以考虑批量替换md中的图片链接。<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">"s#//.*bkt.clouddn#//new.bkt.clouddn#g"</span> file.md</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://picgo.github.io/PicGo-Doc/zh/guide/config.html#%E4%B8%83%E7%89%9B%E5%9B%BE%E5%BA%8A" target="_blank" rel="noopener">PicGo官方文档-七牛图床配置</a></li>
<li><a href="https://blog.csdn.net/yefcion/article/details/82314069" target="_blank" rel="noopener">yefcion-搭建自己的图床：七牛云+Mpic【弃】</a></li>
<li><a href="https://segmentfault.com/a/1190000013374209" target="_blank" rel="noopener">neal-通过七牛云建立私有图床</a></li>
<li><a href="https://www.jianshu.com/p/2097bef17cbe" target="_blank" rel="noopener">leil_-替换七牛云测试链接</a></li>
</ol>
<p><img data-src="http://q5bzrqs1j.bkt.clouddn.com/FrYeD7BTfClVSPDOHmpWKfJcMiBh" alt="my-qiniu-is-ok?"></p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>图床搭建</tag>
      </tags>
  </entry>
  <entry>
    <title>那些有趣的博客</title>
    <url>/blog-interesting/</url>
    <content><![CDATA[<h2 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/" target="_blank" rel="noopener">阮一峰的网络日志</a><a id="more"></a>

</li>
</ul>
<h2 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h2><ul>
<li><a href="https://www.matrix67.com/blog/" target="_blank" rel="noopener">Matrix67</a>-许多经典问题</li>
</ul>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><ul>
<li><a href="https://morvanzhou.github.io/" target="_blank" rel="noopener">莫烦PYTHON</a>-Python基础和机器学习</li>
<li><a href="https://foofish.net/" target="_blank" rel="noopener">FOOFISH-PYTHON之禅</a>-Django入门与实践</li>
</ul>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><h2 id="ML"><a href="#ML" class="headerlink" title="ML"></a>ML</h2><h2 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h2><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><h2 id="心理学"><a href="#心理学" class="headerlink" title="心理学"></a>心理学</h2><h2 id="艺术"><a href="#艺术" class="headerlink" title="艺术"></a>艺术</h2><h2 id="网络安全"><a href="#网络安全" class="headerlink" title="网络安全"></a>网络安全</h2><ul>
<li><a href="https://www.sqlsec.com/" target="_blank" rel="noopener">国光</a></li>
<li><a href="http://www.hackxc.cc/" target="_blank" rel="noopener">小陈’s Blog</a></li>
<li><a href="https://www.92ez.com/" target="_blank" rel="noopener">一只猿</a></li>
</ul>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>在博客中展示Github-Chart</title>
    <url>/%E5%9C%A8%E5%8D%9A%E5%AE%A2%E4%B8%AD%E5%B1%95%E7%A4%BAGithub-Chart/</url>
    <content><![CDATA[<p>今天给大家介绍一个很有意思的网站：<a href="https://ghchart.rshah.org/" target="_blank" rel="noopener">GitHub Chart API</a></p>
<p>更准确的说是一个很有趣的 API。它可以实时的将 GitHub Chart 信息转化成一张图片，就像这样</p>
<p><img data-src="https://ghchart.rshah.org/growvv" alt="GitHub Chart"></p>
<a id="more"></a>

<p>使用方法也很简单，只需要在网址 <a href="https://ghchart.rshah.org/" target="_blank" rel="noopener">https://ghchart.rshah.org/</a> 后跟上自己的 GitHub 用户名即可，例如我的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;ghchart.rshah.org&#x2F;growvv</span><br></pre></td></tr></table></figure>

<p>这就是实时你展示 GitHub Chart 的图片的 URL 了，将这个 URL 放在 <code>&lt;img&gt;</code> 标签里就可以在任意网页上展示了</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">"GitHub Chart"</span> <span class="attr">src</span>=<span class="string">"https://ghchart.rshah.org/growvv"</span> &gt;</span></span><br></pre></td></tr></table></figure>

<p>如果是在 Markdown 中，应该这么写</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">GitHub Chart</span>](<span class="link">https://ghchart.rshah.org/growvv</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>多端互动演示工具</title>
    <url>/%E5%A4%9A%E7%AB%AF%E4%BA%92%E5%8A%A8%E6%BC%94%E7%A4%BA%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200203225755.jpg" alt=""></p>
<a id="more"></a>
<p>第一次体验是在大一的年级大会，可以微信扫码留言，觉得很nb。如今我已经大三，还是这么菜……</p>
<p>现在，这样的产品国内外都有很多。</p>
<p>主要功能包括：</p>
<ul>
<li>签到</li>
<li>聊天上墙</li>
<li>现场抽奖</li>
<li>现场投票</li>
<li>数据分析</li>
</ul>
<p>这类软件在国内多被称为“现场/大屏互动”工具，<a href="https://www.hixianchang.com/" target="_blank" rel="noopener">Hi现场</a>是这类产品的代表。这类产品功能丰富且贴近国情（微信、弹幕、摇一摇），同样界面也很接地气——眼花缭乱、纷繁复杂😵。</p>
<p>后来找到一个面向国内的产品<a href="https://picpiclive.com/zh-cn/" target="_blank" rel="noopener">皮豆互动</a>还不错。</p>
<p>国外的试过<a href="https://www.sli.do/" target="_blank" rel="noopener">Slido</a>。</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>Sublime Text配置文件</title>
    <url>/Sublime-Text%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;translate_tabs_to_spaces&quot;: true,  &#x2F;&#x2F;tab 转换为空格</span><br><span class="line">&quot;ensure_newline_at_eof_on_save&quot;: true,  &#x2F;&#x2F;保存时末尾自动增加一个空行</span><br><span class="line">&quot;trim_trailing_white_space_on_save&quot;: true  &#x2F;&#x2F;删除行尾多余的空格</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>有人可以模仿领导的口吻跟我说一句话吗？</title>
    <url>/%E6%9C%89%E4%BA%BA%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF%E9%A2%86%E5%AF%BC%E7%9A%84%E5%8F%A3%E5%90%BB%E8%B7%9F%E6%88%91%E8%AF%B4%E4%B8%80%E5%8F%A5%E8%AF%9D%E5%90%97%EF%BC%9F/</url>
    <content><![CDATA[<p>别看你今天闹得欢，小心啊今后拉清单，这都得应验的。不要干这种事情。头上三尺有神明，一定要有敬畏之心。</p>
<p>我的话讲完了。</p>
<p>那我简单说两句吧。</p>
<p>我亲自打字，亲自回复。</p>
<a id="more"></a>

<p>一心一意谋发展，聚精会神搞建设。</p>
<p>暗总理，你来当组长，我亲自指挥。</p>
<p>来我办公室一趟~</p>
<p>下面，我再补充两句。</p>
<p>“要提供政治敏感性”</p>
<p>要顾全大局，甘于奉献，组织上派你去，是对你的信任，不要辜负了组织对你的期望。</p>
<p>…</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>twitter</tag>
      </tags>
  </entry>
  <entry>
    <title>搭建内网穿透环境</title>
    <url>/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<p>推荐<strong>NATAPP</strong><br><a href="https://natapp.cn/article/natapp_newbie" target="_blank" rel="noopener">官方教程</a>十分详细，<br>免费版只能用于测试，因为它的url会一直变。</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>宅</title>
    <url>/%E5%AE%85/</url>
    <content><![CDATA[<p>终于到了啥也不干在家躺着就能给社会作贡献的时候了。</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>寒假</tag>
      </tags>
  </entry>
  <entry>
    <title>QQ邮箱收不到Instagram发来的验证码怎么办？</title>
    <url>/QQ%E9%82%AE%E7%AE%B1%E6%94%B6%E4%B8%8D%E5%88%B0Instagram%E5%8F%91%E6%9D%A5%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F/</url>
    <content><![CDATA[<p>当然是让它收到验证码啊！！</p>
<a id="more"></a>
<ul>
<li>方法一：重置密码。这个密码我能收到，但验证登陆的验证码还是收不到，卒！</li>
<li>方法二：将<a href="mailto:no-reply@mail.instagram.com">no-reply@mail.instagram.com</a>添加到通讯录，没变化，卒！！</li>
<li>方法三：将网页版改成英文（在页脚-语言），收到了！！！</li>
</ul>
<p>知乎问题<a href="https://www.zhihu.com/question/63818121" target="_blank" rel="noopener">【QQ邮箱收不到Instagram发来的验证码怎么办？如图？】</a>中还有一种方法——设置白名单，我没试。<br>是前面累积得效果？还是只有最后一步？总之，问题解决得，</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>instagram</tag>
      </tags>
  </entry>
  <entry>
    <title>摸鱼</title>
    <url>/mm-fish/</url>
    <content><![CDATA[<p><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200118230802.jpg" alt=""></p>
<p>今天又是元气满满的一天。</p>
<a id="more"></a>

<p>没想到吧，我还有吃的。</p>
]]></content>
      <categories>
        <category>技术</category>
      </categories>
      <tags>
        <tag>杂项</tag>
      </tags>
  </entry>
  <entry>
    <title>新年倒计时</title>
    <url>/newyear/</url>
    <content><![CDATA[<p>今天是大寒，过几天就过年了。<br>在家养生是真的舒服！<br><img data-src="https://cdn.jsdelivr.net/gh/growvv/img/images/20200120151311.png" alt=""></p>
<a id="more"></a>

]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>寒假</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
